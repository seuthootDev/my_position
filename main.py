import requests
import pandas as pd
import random




def fetch_kosis_data():
    url = "https://kosis.kr/openapi/Param/statisticsParameterData.do"
    params = {
        "method": "getList",
        "apiKey": "N2Q5OGNkNjU0MjNkNTdhNWEwMDRlNjI3N2NmY2YxYTg=",  # ì‹¤ì œ API í‚¤ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
        "itmId": "T001",
        "objL1": "ALL",
        "objL2": "ALL",
        "objL3": "",
        "objL4": "",
        "objL5": "",
        "objL6": "",
        "objL7": "",
        "objL8": "",
        "format": "json",
        "jsonVD": "Y",
        "prdSe": "Y",
        "newEstPrdCnt": 1,
        "orgId": 101,
        "tblId": "DT_1EP_2006"
    }

    
    
    response = requests.get(url, params=params)
    
    if response.status_code == 200:
        data = response.json()

        income_positions = {
            "85ë§Œì› ë¯¸ë§Œ": [
                "ğŸ«¥ ì‚¬íšŒì˜ ìˆ¨ì€ ê³ ìˆ˜... ì•„ë‹ˆ, ìƒì¡´ ë§ˆìŠ¤í„°! ğŸ’° ì•„ë‚Œì˜ ë‹¬ì¸!",
                "ğŸ ì•Œëœ°í•¨ì˜ ëíŒì™•! í˜¹ì‹œ ì¿ í°ë¶ ë“¤ê³  ë‹¤ë‹ˆì‹œë‚˜ìš”? ğŸ“–",
                "ğŸ’¡ ì•Œë°” ì›”ê¸‰ì´ ìƒí™œë¹„... í•˜ì§€ë§Œ ê¿ˆê³¼ í¬ë§ì€ ê°€ë“! ğŸŒˆ"
            ],
            "85ï½150ë§Œì› ë¯¸ë§Œ": [
                "ğŸœ í¸ì˜ì  VIP ê³ ê°! ë¼ë©´ ì‹ ìƒ ë‚˜ì˜¤ë©´ ì œì¼ ë¨¼ì € ì•Œì§€? ğŸ¤£",
                "ğŸš² ì¶œí‡´ê·¼ì€ ë”°ë¦‰ì´! ì§€í•˜ì²  ê¸°ë³¸ìš”ê¸ˆë„ ë¶€ë‹´ë˜ëŠ” ê·¸ ëŠë‚Œ... ğŸ˜µ",
                "ğŸ«  ë°°ë‹¬ì•± ì¥ë°”êµ¬ë‹ˆì— ë‹´ê³  ê²°ì œëŠ” ì·¨ì†Œ... ì˜¤ëŠ˜ë„ ì§ì ‘ í•´ë¨¹ëŠ”ë‹¤! ğŸ³"
            ],
            "150ï½250ë§Œì› ë¯¸ë§Œ": [
                "ğŸ“‰ í……ì¥ê³¼ì˜ ì‹¸ì›€! ë§¤ë‹¬ 25ì¼ì´ â€˜Doomsdayâ€™ ğŸ˜µ",
                "â˜• ì¹´í˜ ê°ˆ ë•Œ, â€˜ì•„ë©”ë¦¬ì¹´ë…¸ë§Œ ë§ˆì‹¤ê²Œìš”â€™ê°€ ì…ë²„ë¦‡! ğŸ’¸",
                "ğŸ“Š ì›”ê¸‰ ë£¨íŒ¡ ì¤‘? í˜„ì‹¤ì€ ìƒí™œë¹„ë¡œ ì¦ë°œ ì¤‘... ğŸ’€"
            ],
            "250ï½350ë§Œì› ë¯¸ë§Œ": [
                "ğŸ“ˆ ì´ì œ ë§‰ ì¤‘ì‚°ì¸µ ì…ì„± ì¤€ë¹„! í•œ ê±¸ìŒì”© ìœ„ë¡œ ê°€ë³´ìê³ ! ğŸ”¥",
                "ğŸš† 'ëŒ€ì¤‘êµí†µ ì •ê¸°ê¶Œ'ì´ ì œì¼ íš¨ìœ¨ì ì¸ ì†Œë¹„ë¼ê³  ë¯¿ëŠ” ë‹¹ì‹ ! ğŸŸï¸",
                "ğŸ¥‘ ê±´ê°• ì±™ê¸¸ ì—¬ìœ ëŠ” ìƒê²¼ì§€ë§Œ, ì•„ë³´ì¹´ë„ëŠ” ì•„ì§ ì‚¬ì¹˜?! ğŸ¤”"
            ],
            "350ï½450ë§Œì› ë¯¸ë§Œ": [
                "ğŸ’¼ ì§ì¥ì¸ ë£¨í‚¤! ì›”ê¸‰ë‚  ì €ê°€ ì»¤í”¼ìƒµ ë§ê³ , ìŠ¤íƒ€ë²…ìŠ¤ ê°€ëŠ” ì—¬ìœ ? â˜•",
                "ğŸ– ê°€ë” ì‚¼ê²¹ì‚´ 3ì¸ë¶„ í˜¼ì ë¨¹ì–´ë„ ì§€ê°‘ì´ ì•ˆ ì•„í”ˆ ë‹¨ê³„! ğŸ¥©",
                "ğŸš• ì§€í•˜ì²  ëŠê¸°ë©´ íƒì‹œ íƒˆê¹Œ ë§ê¹Œ ì‹¬ê°í•œ ê³ ë¯¼ ì‹œì‘! ğŸ¤¯"
            ],
            "450ï½550ë§Œì› ë¯¸ë§Œ": [
                "ğŸ’³ ì†Œì†Œí•œ í”Œë ‰ìŠ¤ ê°€ëŠ¥! ì¹œêµ¬ë“¤ ì‚¬ì´ì—ì„œ â€˜í•œ í„± ì´!â€™ ë“£ëŠ” ìˆ˜ì¤€! ğŸ–",
                "ğŸ¨ ê°€ë” í˜¸ìº‰ìŠ¤ë„ ê°€ëŠ” ì§ì¥ì¸, â€˜ì¼ìƒì´ ì—¬í–‰â€™ì´ ëª©í‘œ! âœˆï¸",
                "ğŸ“± ì‹ í˜• ì•„ì´í° ë‚˜ì˜¤ë©´ ì‚´ê¹Œ ë§ê¹Œ ì§„ì§€í•˜ê²Œ ê³ ë¯¼í•˜ëŠ” ë‹¨ê³„! ğŸ"
            ],
            "550ï½650ë§Œì› ë¯¸ë§Œ": [
                "ğŸš— ì¶œí‡´ê·¼ ì§€í•˜ì² ? ì´ì œ ìŠ¬ìŠ¬ ë‚´ ì°¨ ë½‘ì„ ê³ ë¯¼í•˜ëŠ” ë‹¨ê³„! ğŸï¸",
                "ğŸ’¸ 2ì°¨ê¹Œì§€ëŠ” ê±±ì • ì—†ì´ ì  ìˆ˜ ìˆëŠ” ë‹¹ì‹ , ë¦¬ìŠ¤í™! ğŸ™Œ",
                "ğŸ  ì›ë£¸ íƒˆì¶œ D-100?! ë‚´ ì§‘ ë§ˆë ¨ì„ ê¿ˆê¾¸ëŠ” í˜„ì‹¤ì ì¸ ìì‚°ê°€! ğŸ”‘"
            ],
            "650ï½800ë§Œì› ë¯¸ë§Œ": [
                "ğŸ  â€˜ë¶€ë™ì‚° ì–´í”Œâ€™ ìì£¼ ì¼œê³  ìˆëŠ” ë‹¹ì‹ ! ë‚´ ì§‘ ë§ˆë ¨ì´ ëˆˆì•? ğŸ‘€",
                "ğŸ· ì†Œì£¼ ëŒ€ì‹  ì™€ì¸ìœ¼ë¡œ ê°ˆì•„íƒ„ ë‹¹ì‹ , ì´ì   ë¶„ìœ„ê¸°ë¥¼ ì¦ê¸´ë‹¤! ğŸ¶",
                "ğŸ’¼ 'ì¼ë³´ë‹¤ ëˆì´ ë§ì•„ì•¼ í•œë‹¤'ëŠ” ì² í•™ì„ ê°€ì§€ê¸° ì‹œì‘í•˜ëŠ” ë‹¨ê³„! ğŸ“Š"
            ],
            "800ï½1000ë§Œì› ë¯¸ë§Œ": [
                "ğŸ¤‘ ì¢€ ì¹˜ëŠ” ì‚¬ëŒ! í˜¹ì‹œ ì£¼ë³€ì—ì„œ 'íˆ¬ì ì¢€ ê°€ë¥´ì³ì¤˜' ì†Œë¦¬ ë“£ì§€? ğŸ¤©",
                "ğŸ’ ëª…í’ˆ ì‡¼í•‘í•  ë•Œ ê°€ê²©ì„ ë¨¼ì € ì•ˆ ë³´ê²Œ ë˜ëŠ” ë‹¨ê³„?! ğŸ‘”",
                "âœˆï¸ ì´ì œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì„ í•œ ë²ˆ íƒ€ë³¼ê¹Œ? ìŠ¹ê¸‰ ê³ ë¯¼ ì‹œì‘! ğŸ’º"
            ],
            "1000ë§Œì› ì´ìƒ": [
                "ğŸš€ ëŒ€í•œë¯¼êµ­ ìƒìœ„ 1% í´ëŸ½ ê°€ì… ì™„ë£Œ! í˜¹ì‹œ ì¬ë²Œ 3ì„¸ì„¸ìš”? ğŸ‘‘",
                "ğŸï¸ ì›”ê¸‰ì´ ì•„ë‹ˆë¼ ìì‚°ì´ ëˆì„ ë²„ëŠ” ë‹¨ê³„... í˜¹ì‹œ FIREì¡±? ğŸ”¥",
                "ğŸ’° â€˜ì´ ì •ë„ë©´ ì¶©ë¶„í•´â€™ë¼ëŠ” ë§ì„ ì•ˆ í•´ë³¸ ì‚¬ëŒ! ì§„ì •í•œ í”Œë ‰ì„œ! ğŸ¦"
            ]
        }

        lst = list(income_positions.keys())

        def get_income_message(income):
            messages = income_positions.get(income, ["ğŸ˜¶ í•´ë‹¹í•˜ëŠ” ë©”ì‹œì§€ê°€ ì—†ë„¤...!"])
            return random.choice(messages)

        
        
        # JSON ë°ì´í„°ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
        df = pd.DataFrame(data)
        
        # í•„ìš”í•œ ì»¬ëŸ¼ ì„ íƒ ë° ì •ë ¬
        df = df[["C2_NM", "C1_NM","DT"]]
        df.columns = ["ì—°ë ¹ëŒ€", "ì†Œë“", "ë°±ë¶„ìœ„"]

        # ì†Œë“ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ì˜¤ë¦„ì°¨ìˆœ)
        df = df.sort_values(by="ì†Œë“", ascending=True)
        
        # print(df["ì†Œë“"].unique())  
        # print(df["ì—°ë ¹ëŒ€"].unique())  
        age = "55~59ì„¸"
        income = "550ï½650ë§Œì› ë¯¸ë§Œ"
        
        cnt = lst.index(income)

        ë°±ë¶„ìœ„ê°’ = df.loc[(df["ì—°ë ¹ëŒ€"] == age) & (df["ì†Œë“"] == income), "ë°±ë¶„ìœ„"].values[0]
        mean = df.loc[(df["ì—°ë ¹ëŒ€"] == age) & (df["ì†Œë“"] == "ì¤‘ìœ„ì†Œë“"), "ë°±ë¶„ìœ„"].values[0]
        avg = df.loc[(df["ì—°ë ¹ëŒ€"] == age) & (df["ì†Œë“"] == "í‰ê· ì†Œë“"), "ë°±ë¶„ìœ„"].values[0]
        print(ë°±ë¶„ìœ„ê°’)
        print(mean)
        print(avg)

        print("cnt",cnt)

        sum = 0
        for i in range(cnt, -1, -1):  # cntë¶€í„° 0ê¹Œì§€ ê°ì†Œ (step=-1)
            unit = df.loc[(df["ì—°ë ¹ëŒ€"] == age) & (df["ì†Œë“"] == lst[i]), "ë°±ë¶„ìœ„"].values[0]
            print("unit",unit)
            sum = sum + float(unit)

        if sum>50 :
            sum = 100 - sum
            print("ìƒìœ„",sum ,"%")
        else:
            print("í•˜ìœ„",sum ,"%")

        print(get_income_message(income))
        


    else:
        print(f"Error: {response.status_code}")

if __name__ == "__main__":
    fetch_kosis_data()
